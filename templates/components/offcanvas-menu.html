<!-- templates/components/offcanvas-menu.html -->
<div class="offcanvas offcanvas-start" tabindex="-1" id="ccMenu" aria-labelledby="ccMenuLabel">
  <div class="offcanvas-header border-bottom">
    <h5 class="offcanvas-title fw-bold text-primary" id="ccMenuLabel">
      <i class="bi bi-speedometer2 me-2"></i> Circuit City
    </h5>
    <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>

  <div class="offcanvas-body p-0">
    <div class="list-group list-group-flush">

      <!-- Dashboard -->
      <a class="list-group-item list-group-item-action d-flex align-items-center"
         href="/inventory/dashboard/">
        <i class="bi bi-bar-chart-line me-2"></i> Dashboard
      </a>

      <!-- Stock List -->
      <a class="list-group-item list-group-item-action d-flex align-items-center"
         href="/inventory/list/">
        <i class="bi bi-box-seam me-2"></i> Stock List
      </a>

      <!-- Export CSV -->
      <a class="list-group-item list-group-item-action d-flex align-items-center"
         href="/inventory/dashboard/export-csv/">
        <i class="bi bi-filetype-csv me-2"></i> Export CSV
      </a>

      <!-- Scan IN -->
      <a class="list-group-item list-group-item-action d-flex align-items-center"
         href="/inventory/scan-in/">
        <i class="bi bi-plus-square me-2"></i> Scan IN
      </a>

      <!-- Scan SOLD -->
      <a class="list-group-item list-group-item-action d-flex align-items-center"
         href="/inventory/scan-sold/">
        <i class="bi bi-check2-square me-2"></i> Scan SOLD
      </a>

      <!-- Scan Web -->
      <a class="list-group-item list-group-item-action d-flex align-items-center"
         href="/inventory/scan-web/">
        <i class="bi bi-qr-code-scan me-2"></i> Scan (Web)
      </a>

      <!-- Restock Heatmap -->
      <a class="list-group-item list-group-item-action d-flex align-items-center"
         href="#"
         onclick="loadRestockHeatmap()">
        <i class="bi bi-thermometer-half me-2"></i> Restock Heatmap
      </a>

      <!-- Time Check-in -->
      <a class="list-group-item list-group-item-action d-flex align-items-center"
         href="/inventory/time-checkin/">
        <i class="bi bi-clock-history me-2"></i> Time Check-in
      </a>

      <!-- Time Logs -->
      <a class="list-group-item list-group-item-action d-flex align-items-center"
         href="/inventory/time-logs/">
        <i class="bi bi-journal-text me-2"></i> Time Logs
      </a>

      <!-- Wallet -->
      <a class="list-group-item list-group-item-action d-flex align-items-center"
         href="/inventory/wallet/">
        <i class="bi bi-wallet2 me-2"></i> Wallet
      </a>

      <!-- Django Admin -->
      <a class="list-group-item list-group-item-action d-flex align-items-center"
         href="/admin/">
        <i class="bi bi-gear-fill me-2"></i> Django Admin
      </a>
    </div>

    <!-- Battery Indicator -->
    <div class="p-3 border-top">
      <div class="small text-muted mb-1">Stock Battery</div>
      <div class="progress" style="height: 10px;">
        <div id="stockBattery"
             class="progress-bar bg-success"
             role="progressbar"
             style="width: 0%;"
             aria-valuenow="0"
             aria-valuemin="0"
             aria-valuemax="100">
        </div>
      </div>
      <div class="d-flex justify-content-between mt-1">
        <span id="stockBatteryLabel" class="fw-bold">0%</span>
        <span class="text-muted small">Available Stock</span>
      </div>
    </div>
  </div>
</div>

<script>
  // Auto-update Stock Battery Indicator
  async function updateStockBattery() {
    try {
      const res = await fetch("/inventory/api/restock-heatmap/");
      if (!res.ok) return;
      const data = await res.json();

      if (data && data.battery_pct !== undefined) {
        const battery = document.getElementById("stockBattery");
        const batteryLabel = document.getElementById("stockBatteryLabel");

        const pct = data.battery_pct;
        battery.style.width = pct + "%";
        battery.ariaValueNow = pct;
        batteryLabel.innerText = pct + "%";

        if (pct <= 20) battery.className = "progress-bar bg-danger";
        else if (pct <= 50) battery.className = "progress-bar bg-warning";
        else battery.className = "progress-bar bg-success";
      }
    } catch (e) {
      console.error("Battery update failed:", e);
    }
  }

  document.addEventListener("DOMContentLoaded", updateStockBattery);
</script>
