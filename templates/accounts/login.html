{% load static %}
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Sign in · Imajinet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta http-equiv="Cache-Control" content="no-store, no-cache, must-revalidate, max-age=0">
  <meta http-equiv="Pragma" content="no-cache">

  <style>
    :root{
      --ink:#0f172a;
      --muted:#48566b;

      /* Flat primary blue (matches your reset page tone, but no gradient/glow) */
      --blue:#5a86f7;
      --blue-hover:#4a78ee;

      /* Solid green secondary */
      --green:#22c55e;
      --green-hover:#1fb155;

      /* Background + card */
      --bg1:#f6f9ff; --bg2:#e9f0ff;
      --card:#ffffffcc; --border:#e2e8f0cc;
      --radius:18px;

      --logo-h:64px;
    }

    /* Layout: full viewport, center content; no vertical scroll on typical screens */
    *{box-sizing:border-box}
    html,body{height:100%; margin:0}
    body{
      color:var(--ink);
      font:16px/1.5 system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial,"Noto Sans","Helvetica Neue",sans-serif;
      background:
        radial-gradient(1200px 700px at 25% -10%, var(--bg2), transparent 60%),
        radial-gradient(1200px 700px at 120% 120%, var(--bg2), transparent 60%),
        var(--bg1);
      min-height:100svh;
      display:grid;
      place-items:center;          /* centers the card */
      padding:12px;                /* small safe padding, avoids scrollbars */
      overflow-y:hidden;           /* hide accidental scroll */
    }

    .card{
      width:min(560px, 92vw);
      border-radius:var(--radius);
      background:#fff;             /* flat card (no glass to keep it compact) */
      border:1px solid var(--border);
      padding:18px 18px 20px;
      display:flex; flex-direction:column; gap:10px;
      /* tiny shadow to separate from bg but keep “flat” look */
      box-shadow:0 8px 20px rgba(15,23,42,.08);
    }

    .card-logo{display:block; height:var(--logo-h); width:auto; margin:2px auto 6px}
    .sub{margin:0 0 8px; color:#55627a}

    label{display:block; margin:8px 0 4px; font-weight:650; color:#0b1324}
    .input{
      width:100%; padding:12px 14px; border:1px solid #d9e2ef; border-radius:12px;
      background:#fff; font-size:1rem; outline:none;
    }
    .input:focus{border-color:#c8d8ff; box-shadow:0 0 0 3px rgba(99,102,241,.18)}

    .pwd{position:relative}
    .eye{
      position:absolute; right:10px; top:50%; transform:translateY(-50%);
      background:transparent; border:0; cursor:pointer; padding:0; width:28px; height:28px; color:#6b7280;
    }

    /* FLAT primary button */
    .btn{
      width:100%; margin-top:8px; border:0; cursor:pointer; color:#fff; font-weight:800;
      border-radius:12px; padding:12px 14px; font-size:1.02rem;
      background:var(--blue);
      transition:background-color .15s ease, opacity .15s ease;
    }
    .btn:hover{background:var(--blue-hover)}
    .btn:active{opacity:.95}
    .btn[disabled]{opacity:.7; cursor:default}

    /* FLAT green secondary */
    .btn-green{
      width:100%; margin-top:12px; border:0; cursor:pointer; color:#fff; font-weight:800;
      border-radius:12px; padding:12px 14px; font-size:1.02rem;
      background:var(--green);
      transition:background-color .15s ease, opacity .15s ease;
    }
    .btn-green:hover{background:var(--green-hover)}
    .btn-green:active{opacity:.95}

    .links{margin:6px 0 8px}
    .links a{color:#1e40af; text-decoration:none}
    .links a:hover{text-decoration:underline}

    .rule{border:0; border-top:1px solid #eef1fb; margin:8px 0}

    .footnote{color:#64748b; font-size:.92rem; line-height:1.35; margin-top:8px}

    /* Make sure it fits short viewports too */
    @media (max-height: 680px){
      :root{ --logo-h:52px }
      .card{padding:14px}
      .footnote{font-size:.9rem}
      body{padding:8px}
    }
  </style>
</head>
<body>
  <div class="card" role="dialog" aria-labelledby="loginTitle" aria-describedby="loginDesc">
    <!-- Keep your logo -->
    <img class="card-logo" src="{% static 'img/majn.png' %}" alt="Imajinet">

    <p id="loginDesc" class="sub">Sign in to continue.</p>

    {% if messages %}
      {% for m in messages %}
        <div style="background:#e7f2ff;border:1px solid #cfe3ff;color:#0c4a6e;border-radius:10px;padding:.55rem .7rem;margin:2px 0 6px">
          {{ m }}
        </div>
      {% endfor %}
    {% endif %}

    <form id="loginForm" method="post" action="{% url 'accounts:login' %}" novalidate autocomplete="on">
      {% csrf_token %}
      <input type="hidden" name="next" value="{{ next|default:'' }}"/>

      <label for="id_identifier">Email or Username</label>
      <input id="id_identifier" class="input" type="text" name="identifier"
             value="{{ form.identifier.value|default_if_none:'' }}" autocomplete="username email" required>

      <label for="id_password">Password</label>
      <div class="pwd">
        <input id="id_password" class="input" type="password" name="password" autocomplete="current-password" required>
        <button type="button" class="eye" aria-label="Show password" title="Show/Hide password">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
            <path d="M1 12s4-7 11-7 11 7 11 7-4 7-11 7-11-7-11-7Z"></path>
            <circle cx="12" cy="12" r="3"></circle>
          </svg>
        </button>
      </div>

      <button id="submitBtn" class="btn" type="submit">Log In</button>
    </form>

    <div class="links">
      <a href="{% url 'accounts:forgot_password_request' %}">Forgot password?</a>
    </div>

    <hr class="rule">

    <button class="btn-green" onclick="location.href='{% url 'accounts:signup_manager' %}'">
      Create a Manager account
    </button>

    <p class="footnote">
      Managers create the store and invite agents later.<br>
      Agents should request an invite link.
    </p>
  </div>

  <script>
    // Password show/hide
    (function(){
      const btn = document.querySelector('.eye');
      const input = document.getElementById('id_password');
      if(btn && input){
        let shown = false;
        btn.addEventListener('click', function(){
          shown = !shown;
          input.type = shown ? 'text' : 'password';
          btn.setAttribute('aria-label', shown ? 'Hide password' : 'Show password');
        });
      }
    })();

    // Prevent re-POST on refresh
    try {
      if (history.replaceState) {
        history.replaceState(null, document.title, location.pathname + location.search);
      }
      addEventListener('pageshow', e => { if (e.persisted) location.reload(); });
    } catch(e){}
  </script>
</body>
</html>
