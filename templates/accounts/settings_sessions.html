{% extends "base.html" %}
{% load static %}

{% block title %}Settings · Sessions{% endblock %}
{% block header_title %}Settings{% endblock %}

{# Hide Layby + Notifications on settings pages #}
{% block extra_head %}
<style>
  .cc-header .cc-actions { display: none !important; }
</style>
{% endblock %}

{% block content %}
<div class="container my-4">
  <h2 class="fw-bold mb-3">Account Settings</h2>
  {% include "accounts/_settings_nav.html" %}

  {% if messages %}
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  {% endif %}

  <div class="card shadow-sm border-0 rounded-3">
    <div class="card-body p-4">
      <h5 class="fw-semibold mb-3"><i class="bi bi-phone me-1"></i> Active Sessions</h5>
      <p class="text-muted">
        These are the devices where you’re currently signed in.
        For security, you can terminate all other sessions except this one.
      </p>

      {% if sessions %}
        <div class="table-responsive">
          <table class="table align-middle">
            <thead>
              <tr>
                <th scope="col">Session Key</th>
                <th scope="col">Device / Info</th>
                <th scope="col">Expires</th>
                <th scope="col">Status</th>
              </tr>
            </thead>
            <tbody>
              {% for session in sessions %}
                {% with session.get_decoded as data %}
                  <tr>
                    <td class="small text-muted">{{ session.session_key|truncatechars:12 }}</td>
                    <td>
                      {% if data.user_agent %}
                        {{ data.user_agent }}
                      {% else %}
                        <span class="text-muted">Unknown Device</span>
                      {% endif %}
                    </td>
                    <td>{{ session.expire_date|date:"M d, Y H:i" }}</td>
                    <td>
                      {% if session.session_key == request.session.session_key %}
                        <span class="badge bg-success">Current Session</span>
                      {% else %}
                        <span class="badge bg-secondary">Active</span>
                      {% endif %}
                    </td>
                  </tr>
                {% endwith %}
              {% endfor %}
            </tbody>
          </table>
        </div>

        <form action="{% url 'accounts:terminate_other_sessions' %}" method="post" class="mt-3">
          {% csrf_token %}
          <button type="submit" class="btn btn-danger">
            <i class="bi bi-x-circle me-1"></i> Terminate Other Sessions
          </button>
        </form>
      {% else %}
        <div class="alert alert-info d-flex align-items-center mt-3" role="alert">
          <i class="bi bi-info-circle-fill me-2"></i>
          <div>No active sessions found.</div>
        </div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
