{% extends "base.html" %}
{% block title %}Sign in Â· Circuit City{% endblock %}

{% block body %}
<div class="bg" style="min-height:100dvh;display:grid;place-items:center;padding:2rem">
  <div class="card" style="width:min(460px,92vw);padding:2rem">
    <div style="display:flex;align-items:center;gap:.75rem;margin-bottom:1rem">
      <svg width="28" height="28" viewBox="0 0 24 24" fill="none" aria-hidden="true">
        <defs>
          <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
            <stop stop-color="#2f77ff"/><stop offset="1" stop-color="#0b3a7e"/>
          </linearGradient>
        </defs>
        <path d="M3 12a9 9 0 1 0 18 0A9 9 0 0 0 3 12Zm7.5 4.5 6-6m-7.75-.75h.01M8 15h4"
              stroke="url(#g)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
      </svg>
      <h1 class="brand" style="margin:0;font-size:1.35rem">Circuit City Portal</h1>
    </div>

    {# error banner (non-field or bad creds) #}
    {% if form.errors or form.non_field_errors %}
      <div style="background:#fee2e2;color:#991b1b;border:1px solid #fecaca;
                  padding:.75rem 1rem;border-radius:.75rem;margin-bottom:1rem" role="alert">
        Please check your username and password and try again.
      </div>
    {% endif %}

    <form method="post" action="{% url 'login' %}" novalidate style="display:grid;gap:1rem">
      {% csrf_token %}
      {% if next %}<input type="hidden" name="next" value="{{ next }}">{% endif %}

      <div>
        <label for="id_username" style="display:block;margin:0 0 .35rem;color:#334155;font-weight:600">Username</label>
        <input class="input" id="id_username" name="username" type="text"
               required autocomplete="username" autofocus>
        {% if form.username.errors %}
          <div style="color:#b91c1c;font-size:.9rem;margin-top:.25rem">{{ form.username.errors|striptags }}</div>
        {% endif %}
      </div>

      <div>
        <label for="id_password" style="display:block;margin:0 0 .35rem;color:#334155;font-weight:600">Password</label>
        <div style="display:flex;gap:.5rem;align-items:center">
          <input class="input" id="id_password" name="password" type="password"
                 required autocomplete="current-password" style="flex:1">
          <button type="button" class="btn" id="toggle-pass">Show</button>
        </div>
        {% if form.password.errors %}
          <div style="color:#b91c1c;font-size:.9rem;margin-top:.25rem">{{ form.password.errors|striptags }}</div>
        {% endif %}
        <div style="margin-top:.35rem">
          <a href="{% url 'password_reset' %}" style="font-size:.95rem;text-decoration:none;color:#2563eb">
            Forgot your password?
          </a>
        </div>
      </div>

      <div style="display:flex;gap:.5rem;align-items:center">
        <input type="checkbox" id="remember" name="remember" value="1" checked>
        <label for="remember" style="color:#334155;">Stay signed in for 14 days</label>
      </div>

      <div style="display:flex;gap:.6rem;flex-wrap:wrap;margin-top:.25rem">
        <button class="btn btn-primary" type="submit">Sign in</button>
        <a class="btn" href="{% url 'home' %}" style="background:#64748b">Cancel</a>
      </div>
    </form>
  </div>
</div>

<script>
  // show/hide password
  (function(){
    const btn = document.getElementById('toggle-pass');
    const input = document.getElementById('id_password');
    if(btn && input){
      btn.addEventListener('click', () => {
        const isPwd = input.type === 'password';
        input.type = isPwd ? 'text' : 'password';
        btn.textContent = isPwd ? 'Hide' : 'Show';
        input.focus();
      });
    }
  })();
</script>
{% endblock %}
