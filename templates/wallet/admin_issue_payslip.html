{% extends "base.html" %}
{% load humanize %}

{% block title %}Issue Single Payslip · Wallet Admin{% endblock %}
{% block header_title %}<i class="bi bi-receipt me-2"></i>Issue Single Payslip{% endblock %}

{% block body %}
<div class="container-xxl px-0">

  <div class="alert alert-light border d-flex align-items-start gap-2 mb-3" role="alert">
    <i class="bi bi-info-circle mt-1"></i>
    <div class="small">
      This will compute <b>base salary + commissions + bonuses</b>, subtract <b>deductions</b> for
      the chosen period, create/update a payslip, and (optionally) email it immediately.
    </div>
  </div>

  <div class="card shadow-sm border-0">
    <div class="card-body">
      <form method="post" action="{% url 'wallet:admin_issue_payslip' %}">
        {% csrf_token %}

        <div class="row g-3">
          <div class="col-12">
            <label class="form-label fw-semibold">Agent</label>
            <select name="agent_id" class="form-select" required>
              {% for a in agents %}
                <option value="{{ a.id }}">{{ a.get_full_name|default:a.username }}</option>
              {% endfor %}
            </select>
          </div>

          <div class="col-md-4">
            <label class="form-label fw-semibold">Year</label>
            <input type="number" name="year" class="form-control"
                   min="2020" max="2100" value="{{ year }}" required>
          </div>

          <div class="col-md-4">
            <label class="form-label fw-semibold">Month</label>
            <input type="number" name="month" class="form-control"
                   min="1" max="12" value="{{ month }}" required>
          </div>

          <div class="col-md-4">
            <label class="form-label fw-semibold">Payment Method (optional / future)</label>
            <select name="method" class="form-select">
              <option value="">—</option>
              <option value="MANUAL">Manual</option>
              <option value="NB">National Bank</option>
              <option value="SB">Standard Bank</option>
              <option value="AM">Airtel Money</option>
            </select>
          </div>

          <div class="col-12">
            <div class="form-check">
              <input class="form-check-input" type="checkbox" id="send_now" name="send_now" value="1">
              <label class="form-check-label" for="send_now">Email payslip now</label>
            </div>
          </div>
        </div>

        <div class="mt-3">
          <button class="btn btn-primary">
            <i class="bi bi-send-check me-1"></i>Issue Payslip
          </button>
          <a href="{% url 'wallet:admin_payslips' %}" class="btn btn-outline-secondary ms-2">Back</a>
        </div>
      </form>
    </div>
  </div>
</div>
{% endblock %}
