{% extends "base.html" %}
{% block title %}Issue Payslip · Admin Wallet{% endblock %}

{% block header_title %}<i class="bi bi-receipt me-2"></i>Issue Payslip{% endblock %}

{% block content %}
<div class="container-xxl px-0">
  <div class="card shadow-sm border-0">
    <div class="card-body">
      <p class="text-muted mb-3">
        Select an agent and a month. The system will compute Gross/Deductions from wallet
        transactions for that period, create a <em>Payslip</em> record, and post a <strong>PAYSLIP</strong>
        wallet transaction (negative on the agent wallet, mirrored on company wallet).
      </p>

      <form method="post" class="row g-3">
        {% csrf_token %}

        <div class="col-md-6">
          <label class="form-label fw-semibold">Agent</label>
          <select name="agent_id" class="form-select" required>
            <option value="" disabled selected>Choose agent…</option>
            {% for a in agents %}
              <option value="{{ a.id }}">
                {{ a.first_name }} {{ a.last_name }} {% if a.email %}— {{ a.email }}{% endif %}
              </option>
            {% endfor %}
          </select>
        </div>

        <div class="col-md-3">
          <label class="form-label fw-semibold">Year</label>
          <input type="number" name="year" class="form-control"
                 min="2020" max="2100" value="{{ default_year }}" required>
        </div>

        <div class="col-md-3">
          <label class="form-label fw-semibold">Month</label>
          <select name="month" class="form-select" required>
            {% for m in "1,2,3,4,5,6,7,8,9,10,11,12".split(",") %}
              <option value="{{ m|add:0 }}" {% if default_month == m|add:0 %}selected{% endif %}>
                {{ m|add:0|stringformat:"02d" }}
              </option>
            {% endfor %}
          </select>
        </div>

        <div class="col-12 d-flex gap-2">
          <a href="{% url 'wallet:admin_home' %}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left"></i> Back
          </a>
          <button class="btn btn-primary">
            <i class="bi bi-send"></i> Issue Payslip
          </button>
        </div>
      </form>

      <hr class="my-4">

      <div class="alert alert-info small mb-0">
        <div class="fw-semibold mb-1">What’s next?</div>
        <ul class="mb-0">
          <li>Bulk issue & scheduling UI will live here (select many agents, auto-send on a chosen day).</li>
          <li>Future payment methods (National Bank / Standard Bank / Airtel Money) can create a <em>Payment</em> record linked to the payslip.</li>
        </ul>
      </div>
    </div>
  </div>
</div>
{% endblock %}
