{% extends "base.html" %}
{% load humanize %}

{% block title %}Agent Wallet · {{ target.username }}{% endblock %}

{% block body %}
<section>
  <h2 style="margin:0 0 .5rem">Agent: {{ target.get_username }}</h2>

  <div style="display:flex; gap:.5rem; flex-wrap:wrap; margin:.5rem 0 1rem">
    <span class="pill">Balance: <strong>MK {{ balance|floatformat:0|intcomma }}</strong></span>
    <span class="pill">Monthly earnings: <strong>MK {{ monthly_total|floatformat:0|intcomma }}</strong></span>
    <span class="pill">Monthly ADV: <strong>MK {{ monthly_adv|floatformat:0|intcomma }}</strong></span>
    <span class="pill">Lifetime earnings: <strong>MK {{ lifetime_total|floatformat:0|intcomma }}</strong></span>
  </div>

  <h3 style="margin:.5rem 0">Wallet transactions (COM/ADV/ADJ)</h3>
  <table class="table">
    <thead>
      <tr>
        <th>Date</th>
        <th>Reason</th>
        <th style="text-align:right">Amount (MK)</th>
        <th>Memo</th>
      </tr>
    </thead>
    <tbody>
      {% for t in txns %}
      <tr>
        <td>{{ t.created_at|date:"Y-m-d H:i" }}</td>
        <td>{{ t.get_reason_display }}</td>
        <td style="text-align:right">
          {% if t.amount < 0 %}-{% endif %}{{ t.amount|abs|floatformat:0|intcomma }}
        </td>
        <td>{{ t.memo }}</td>
      </tr>
      {% empty %}
      <tr><td colspan="4" style="text-align:center;color:var(--cc-muted)">No transactions yet.</td></tr>
      {% endfor %}
    </tbody>
  </table>

  {% if page_obj.has_other_pages %}
    <nav class="pagination" style="margin-top:.75rem; display:flex; gap:.5rem;">
      {% if page_obj.has_previous %}
        <a class="btn-deep" href="{{ url_for(page_obj.previous_page_number) }}">← Prev</a>
      {% endif %}
      <span class="pill">Page {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>
      {% if page_obj.has_next %}
        <a class="btn-deep" href="{{ url_for(page_obj.next_page_number) }}">Next →</a>
      {% endif %}
    </nav>
  {% endif %}
</section>
{% endblock %}
