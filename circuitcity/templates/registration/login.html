{% extends "base.html" %}
{% block title %}Sign in Â· Circuit City{% endblock %}

{% block body %}
<div class="login-page">
  <div class="bg" style="min-height:100dvh;display:grid;place-items:center;padding:2rem">
    <div class="card" style="width:min(520px,100%);padding:1.5rem">
      <h2 class="brand" style="margin:0 0 1rem; font-weight:700;">Sign in</h2>

      {% if form.errors or form.non_field_errors %}
        <div style="margin:.5rem 0 1rem;padding:.75rem 1rem;border-radius:.75rem;
                    background:#fee2e2;border:1px solid #fecaca;color:#7f1d1d;"
             role="alert" aria-live="assertive">
          Please check your username and password and try again.
        </div>
      {% endif %}

      <form method="post" action="{% url 'login' %}" novalidate style="display:grid;gap:1rem">
        {% csrf_token %}
        {% if next %}<input type="hidden" name="next" value="{{ next }}">{% endif %}

        <!-- Username -->
        <div>
          <label for="username-input" style="display:block;margin:0 0 .4rem;color:#334155;font-weight:600">
            Username
          </label>
          <input class="input" id="username-input" name="username" type="text"
                 required autocomplete="username" autofocus
                 value="{{ form.username.value|default_if_none:'' }}"
                 aria-invalid="{{ form.username.errors|yesno:'true,false' }}">
          {% if form.username.errors %}
            <div class="small" style="color:#b91c1c;margin-top:.25rem;">
              {{ form.username.errors.0 }}
            </div>
          {% endif %}
        </div>

        <!-- Password + show/hide -->
        <div>
          <label for="password-input" style="display:block;margin:0 0 .4rem;color:#334155;font-weight:600">
            Password
          </label>
          <div style="display:flex;gap:.5rem;align-items:center">
            <input class="input" id="password-input" name="password" type="password"
                   required autocomplete="current-password"
                   aria-invalid="{{ form.password.errors|yesno:'true,false' }}">
            <button type="button" class="btn" id="toggle-pass" aria-controls="password-input" aria-pressed="false">
              Show
            </button>
          </div>
          {% if form.password.errors %}
            <div class="small" style="color:#b91c1c;margin-top:.25rem;">
              {{ form.password.errors.0 }}
            </div>
          {% endif %}
          <div style="margin-top:.35rem">
            <a href="{% url 'inventory:agent_forgot_password' %}" style="font-size:.95rem;text-decoration:none;color:#2563eb">
              Forgot your password?
            </a>
          </div>
        </div>

        <!-- Stay signed in (requires server-side support to change session expiry) -->
        <div style="display:flex;gap:.5rem;align-items:center">
          <input type="checkbox" id="remember" name="remember" value="1" {% if request.POST.remember %}checked{% endif %}>
          <label for="remember" style="color:#334155;">Stay signed in for 14 days</label>
        </div>

        <!-- Actions -->
        <div style="display:flex;gap:.6rem;flex-wrap:wrap;margin-top:.25rem">
          <button class="btn btn-primary" type="submit">Sign in</button>
          <a class="btn" href="{% url 'root' %}" style="background:#64748b">Cancel</a>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
  // Simple show/hide password toggle
  (function(){
    const btn = document.getElementById('toggle-pass');
    const input = document.getElementById('password-input');
    if(btn && input){
      btn.addEventListener('click', () => {
        const isPwd = input.type === 'password';
        input.type = isPwd ? 'text' : 'password';
        btn.textContent = isPwd ? 'Hide' : 'Show';
        btn.setAttribute('aria-pressed', String(isPwd));
        input.focus();
      });
    }
  })();
</script>
{% endblock %}
