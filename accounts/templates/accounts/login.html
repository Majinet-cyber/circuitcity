{% extends "base.html" %}

{% block title %}Sign in Â· Circuit City{% endblock %}

{% block extra_css %}
<style>
  /* -------- Tokens -------- */
  :root{
    --cc-bg: var(--bg, #f6f9ff);
    --cc-card: var(--card, #ffffff);
    --cc-line: var(--line, #e5e7eb);
    --cc-ink: var(--ink, #0f172a);
    --cc-muted: var(--muted, #64748b);

    /* Glassmorphic blue */
    --blue-1:#2563eb; /* base */
    --blue-2:#60a5fa; /* tint */
    --glass-bg: rgba(37,99,235,0.12);
    --glass-brd: rgba(96,165,250,.55);
    --glass-shadow: 0 10px 30px rgba(37,99,235,.22);
  }

  body{ background: linear-gradient(180deg, var(--cc-bg), #fff); }

  /* We rely on base.html's global page loader. Only define our spinner keyframes here. */
  @keyframes ccspin { to { transform: rotate(360deg); } }

  /* -------- Layout -------- */
  .auth-wrap{
    min-height: calc(100vh - 0px);
    display: grid;
    place-items: center;
    padding: clamp(16px, 4vw, 32px);
  }
  .auth-card{
    width: min(520px, 92vw);
    background: var(--cc-card);
    border: 1px solid var(--cc-line);
    border-radius: 16px;
    padding: 28px;
    box-shadow: 0 20px 60px rgba(2, 6, 23, .06);
  }
  .brand{
    display: flex; align-items: center; gap: .6rem;
    font-weight: 800; color: var(--cc-ink); margin-bottom: .25rem;
  }
  .muted{ color: var(--cc-muted); }

  .err{
    background: #fef2f2; border: 1px solid #fecaca; color: #991b1b;
    padding: .6rem .8rem; border-radius: 10px; margin-bottom: 12px;
  }

  .pw-wrap{ position: relative; }
  .pw-toggle{
    position: absolute; right: .5rem; top: 50%; transform: translateY(-50%);
    border: none; background: transparent; color: #64748b;
    padding: .25rem; line-height: 0; cursor: pointer;
  }

  /* -------- Glassmorphic Blue Button (stays blue) -------- */
  .btn-glass-blue{
    --_bg: var(--glass-bg);
    --_brd: var(--glass-brd);
    --_txt: #eaf2ff;
    --_txt-strong: #ffffff;

    width: 100%;
    display: inline-flex; align-items: center; justify-content: center; gap: .5rem;
    padding: .9rem 1.15rem;
    font-weight: 800; letter-spacing: .02em;
    border-radius: 14px; border: 1px solid var(--_brd);
    color: var(--_txt);
    background:
      radial-gradient(120% 160% at 30% 20%, rgba(255,255,255,.35), transparent 60%),
      linear-gradient(135deg, rgba(96,165,250,.65), rgba(37,99,235,.55)),
      var(--_bg);
    box-shadow: var(--glass-shadow);
    backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px);
    cursor: pointer;
    transition: transform .18s ease, box-shadow .18s ease, background .18s ease, color .18s ease, opacity .18s ease;
    text-decoration: none;
  }
  .btn-glass-blue:hover,
  .btn-glass-blue:focus{
    transform: translateY(-1px);
    color: var(--_txt-strong);
    box-shadow: 0 14px 34px rgba(37,99,235,.32);
    background:
      radial-gradient(140% 160% at 30% 20%, rgba(255,255,255,.5), transparent 60%),
      linear-gradient(135deg, rgba(96,165,250,.75), rgba(37,99,235,.65)),
      var(--_bg);
  }
  .btn-glass-blue:active{ transform:none; box-shadow:0 8px 22px rgba(37,99,235,.28); }
  .btn-glass-blue:disabled{ opacity:.65; cursor:not-allowed; box-shadow:0 8px 18px rgba(37,99,235,.18); }
</style>
{% endblock %}

{% block body %}
<div class="auth-wrap">
  <div class="auth-card" role="dialog" aria-labelledby="loginTitle" aria-describedby="loginDesc">
    <div class="brand" aria-hidden="true">
      <i class="bi bi-lightning-charge-fill"></i> Circuit City
    </div>
    <p id="loginDesc" class="muted mb-3">Sign in to continue.</p>

    {% if form and form.errors %}
      <div class="err" role="alert" aria-live="assertive">Incorrect username or password. Please try again.</div>
    {% endif %}

    <!-- Post back to the same URL to avoid NoReverseMatch if 'login' URL name/namespace differs -->
    <form method="post" action="" class="vstack gap-2" novalidate>
      {% csrf_token %}

      {% if redirect_field_value %}
        <input type="hidden" name="{{ redirect_field_name }}" value="{{ redirect_field_value }}">
      {% elif next %}
        <input type="hidden" name="next" value="{{ next }}">
      {% endif %}

      <div>
        <label class="form-label" for="id_username">Username</label>
        <input id="id_username" name="username" class="form-control" required autofocus
               autocomplete="username"
               value="{% if form %}{{ form.username.value|default:'' }}{% endif %}">
      </div>

      <div class="pw-wrap">
        <label class="form-label" for="id_password">Password</label>
        <input id="id_password" name="password" type="password" class="form-control"
               required autocomplete="current-password">
        <button class="pw-toggle" type="button" aria-label="Show password" data-state="hidden">
          <i class="bi bi-eye"></i>
        </button>
      </div>

      <!-- Always-blue glassmorphic primary button -->
      <button class="btn-glass-blue mt-2" type="submit" id="loginSubmit">Sign in</button>
    </form>

    <div class="d-flex justify-content-between mt-3">
      <a class="muted text-decoration-none" href="/accounts/password/forgot/">Forgot password?</a>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  // Password show/hide
  (function(){
    const btn = document.querySelector('.pw-toggle');
    const input = document.getElementById('id_password');
    if (!btn || !input) return;
    btn.addEventListener('click', function(){
      const hidden = this.getAttribute('data-state') !== 'visible';
      input.type = hidden ? 'text' : 'password';
      this.setAttribute('data-state', hidden ? 'visible' : 'hidden');
      this.setAttribute('aria-label', hidden ? 'Hide password' : 'Show password');
      this.innerHTML = hidden ? '<i class="bi bi-eye-slash"></i>' : '<i class="bi bi-eye"></i>';
      input.focus({preventScroll:true});
    });
  })();

  // Tiny inline spinner on submit (button remains blue)
  (function(){
    const form = document.querySelector('form[novalidate]');
    const btn  = document.getElementById('loginSubmit');
    if(!form || !btn) return;
    form.addEventListener('submit', function(){
      btn.disabled = true;
      const sp = document.createElement('span');
      sp.style.display='inline-block';
      sp.style.width='1em'; sp.style.height='1em'; sp.style.marginLeft='.5rem';
      sp.style.border='2px solid rgba(255,255,255,.35)';
      sp.style.borderTopColor='#fff'; sp.style.borderRadius='50%';
      sp.style.animation='ccspin .9s linear infinite';
      btn.appendChild(sp);
    });
  })();
</script>
{% endblock %}
